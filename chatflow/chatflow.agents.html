

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>chatflow.agents &mdash; AgentOpera API References 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="chatflow.base" href="chatflow.base.html" />
    <link rel="prev" title="chatflow" href="chatflow.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            AgentOpera API References
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Chatflow Module</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="chatflow.html">chatflow</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">chatflow.agents</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent"><code class="docutils literal notranslate"><span class="pre">BaseChatAgent</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.name"><code class="docutils literal notranslate"><span class="pre">BaseChatAgent.name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.description"><code class="docutils literal notranslate"><span class="pre">BaseChatAgent.description</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.produced_message_types"><code class="docutils literal notranslate"><span class="pre">BaseChatAgent.produced_message_types</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.on_messages"><code class="docutils literal notranslate"><span class="pre">BaseChatAgent.on_messages()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.on_messages_stream"><code class="docutils literal notranslate"><span class="pre">BaseChatAgent.on_messages_stream()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.run"><code class="docutils literal notranslate"><span class="pre">BaseChatAgent.run()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.run_stream"><code class="docutils literal notranslate"><span class="pre">BaseChatAgent.run_stream()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.on_reset"><code class="docutils literal notranslate"><span class="pre">BaseChatAgent.on_reset()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.save_state"><code class="docutils literal notranslate"><span class="pre">BaseChatAgent.save_state()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.load_state"><code class="docutils literal notranslate"><span class="pre">BaseChatAgent.load_state()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.close"><code class="docutils literal notranslate"><span class="pre">BaseChatAgent.close()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.agent_identifier"><code class="docutils literal notranslate"><span class="pre">BaseChatAgent.agent_identifier()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#agentopera.chatflow.agents.AssistantAgent"><code class="docutils literal notranslate"><span class="pre">AssistantAgent</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.AssistantAgent.produced_message_types"><code class="docutils literal notranslate"><span class="pre">AssistantAgent.produced_message_types</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.AssistantAgent.add_tools"><code class="docutils literal notranslate"><span class="pre">AssistantAgent.add_tools()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.AssistantAgent.on_messages"><code class="docutils literal notranslate"><span class="pre">AssistantAgent.on_messages()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.AssistantAgent.check_cancelled"><code class="docutils literal notranslate"><span class="pre">AssistantAgent.check_cancelled()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.AssistantAgent.on_messages_stream"><code class="docutils literal notranslate"><span class="pre">AssistantAgent.on_messages_stream()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.AssistantAgent.on_reset"><code class="docutils literal notranslate"><span class="pre">AssistantAgent.on_reset()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.AssistantAgent.save_state"><code class="docutils literal notranslate"><span class="pre">AssistantAgent.save_state()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.AssistantAgent.load_state"><code class="docutils literal notranslate"><span class="pre">AssistantAgent.load_state()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#agentopera.chatflow.agents.CodeExecutorAgent"><code class="docutils literal notranslate"><span class="pre">CodeExecutorAgent</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.CodeExecutorAgent.produced_message_types"><code class="docutils literal notranslate"><span class="pre">CodeExecutorAgent.produced_message_types</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.CodeExecutorAgent.on_messages"><code class="docutils literal notranslate"><span class="pre">CodeExecutorAgent.on_messages()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.CodeExecutorAgent.on_reset"><code class="docutils literal notranslate"><span class="pre">CodeExecutorAgent.on_reset()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#agentopera.chatflow.agents.SocietyOfMindAgent"><code class="docutils literal notranslate"><span class="pre">SocietyOfMindAgent</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.SocietyOfMindAgent.DEFAULT_INSTRUCTION"><code class="docutils literal notranslate"><span class="pre">SocietyOfMindAgent.DEFAULT_INSTRUCTION</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.SocietyOfMindAgent.DEFAULT_RESPONSE_PROMPT"><code class="docutils literal notranslate"><span class="pre">SocietyOfMindAgent.DEFAULT_RESPONSE_PROMPT</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.SocietyOfMindAgent.DEFAULT_DESCRIPTION"><code class="docutils literal notranslate"><span class="pre">SocietyOfMindAgent.DEFAULT_DESCRIPTION</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.SocietyOfMindAgent.produced_message_types"><code class="docutils literal notranslate"><span class="pre">SocietyOfMindAgent.produced_message_types</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.SocietyOfMindAgent.on_messages"><code class="docutils literal notranslate"><span class="pre">SocietyOfMindAgent.on_messages()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.SocietyOfMindAgent.on_messages_stream"><code class="docutils literal notranslate"><span class="pre">SocietyOfMindAgent.on_messages_stream()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.SocietyOfMindAgent.on_reset"><code class="docutils literal notranslate"><span class="pre">SocietyOfMindAgent.on_reset()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.SocietyOfMindAgent.save_state"><code class="docutils literal notranslate"><span class="pre">SocietyOfMindAgent.save_state()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.SocietyOfMindAgent.load_state"><code class="docutils literal notranslate"><span class="pre">SocietyOfMindAgent.load_state()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#agentopera.chatflow.agents.UserProxyAgent"><code class="docutils literal notranslate"><span class="pre">UserProxyAgent</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.UserProxyAgent.InputRequestContext"><code class="docutils literal notranslate"><span class="pre">UserProxyAgent.InputRequestContext</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#agentopera.chatflow.agents.UserProxyAgent.InputRequestContext.request_id"><code class="docutils literal notranslate"><span class="pre">UserProxyAgent.InputRequestContext.request_id()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.UserProxyAgent.produced_message_types"><code class="docutils literal notranslate"><span class="pre">UserProxyAgent.produced_message_types</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.UserProxyAgent.on_messages"><code class="docutils literal notranslate"><span class="pre">UserProxyAgent.on_messages()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.UserProxyAgent.on_messages_stream"><code class="docutils literal notranslate"><span class="pre">UserProxyAgent.on_messages_stream()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentopera.chatflow.agents.UserProxyAgent.on_reset"><code class="docutils literal notranslate"><span class="pre">UserProxyAgent.on_reset()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="chatflow.base.html">chatflow.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="chatflow.conditions.html">chatflow.conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chatflow.media.html">chatflow.media</a></li>
<li class="toctree-l1"><a class="reference internal" href="chatflow.state.html">chatflow.state</a></li>
<li class="toctree-l1"><a class="reference internal" href="chatflow.team.html">chatflow.team</a></li>
<li class="toctree-l1"><a class="reference internal" href="chatflow.ui.html">chatflow.ui</a></li>
<li class="toctree-l1"><a class="reference internal" href="chatflow.utils.html">chatflow.utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Engine Module</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../engine/engine.html">engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../engine/engine.agent.html">engine.agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../engine/engine.function_call.html">engine.function_call</a></li>
<li class="toctree-l1"><a class="reference internal" href="../engine/engine.protocol.html">engine.protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../engine/engine.runtime.html">engine.runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../engine/engine.telemetry.html">engine.telemetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../engine/engine.types.html">engine.types</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Agents Module</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../agents/agents.html">agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/agents.openai.html">agents.openai</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/agents.magentic_one.html">agents.magentic_one</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/agents.magentic_one_team.html">agents.magentic_one_team</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/agents.web_surfer.html">agents.web_surfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/agents.video_surfer.html">agents.video_surfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/agents.file_surfer.html">agents.file_surfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/agents.code_executor.html">agents.code_executor</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Router Module</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../router/router.html">router</a></li>
<li class="toctree-l1"><a class="reference internal" href="../router/router.workers.html">router.workers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../router/router.user.html">router.user</a></li>
<li class="toctree-l1"><a class="reference internal" href="../router/router.session.html">router.session</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Models Module</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../models/models.html">models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/models.openai.html">models.openai</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/models.anthropic.html">models.anthropic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/models.azure.html">models.azure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/models.ollama.html">models.ollama</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/models.replay.html">models.replay</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/models.cache.html">models.cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/models.utils.html">models.utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Memory Module</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../memory/memory.html">memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../memory/memory.graphrag.html">memory.graphrag</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools Module</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/tools.html">tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/tools.http.html">tools.http</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/tools.code_execution.html">tools.code_execution</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">UI Module</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ui/ui.html">ui</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Utils Module</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../utils/utils.html">utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Adapter Module</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../adapter/adapter.html">adapter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adapter/adapter.langchain.html">adapter.langchain</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">MCP Module</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mcp/mcp.html">mcp</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Zerocode Module</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../zerocode/zerocode.html">zerocode</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Edge Module</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../edge/edge.html">edge</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AgentOpera API References</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">chatflow.agents</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/chatflow/chatflow.agents.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-agentopera.chatflow.agents">
<span id="chatflow-agents"></span><h1>chatflow.agents<a class="headerlink" href="#module-agentopera.chatflow.agents" title="Link to this heading"></a></h1>
<p>This module initializes various pre-defined agents provided by the package.
BaseChatAgent is the base class for all agents in agentopera.</p>
<dl class="py class">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.BaseChatAgent">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">agentopera.chatflow.agents.</span></span><span class="sig-name descname"><span class="pre">BaseChatAgent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/base_chat_agent.html#BaseChatAgent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.BaseChatAgent" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.ChatAgent" title="agentopera.chatflow.base.chat_agent.ChatAgent"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChatAgent</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ABC</span></code></p>
<p>Base class for a chat agent.</p>
<p>This abstract class provides a base implementation for a <code class="xref py py-class docutils literal notranslate"><span class="pre">ChatAgent</span></code>.
To create a new chat agent, subclass this class and implement the
<a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.on_messages" title="agentopera.chatflow.agents.BaseChatAgent.on_messages"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages()</span></code></a>, <a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.on_reset" title="agentopera.chatflow.agents.BaseChatAgent.on_reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_reset()</span></code></a>, and <a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.produced_message_types" title="agentopera.chatflow.agents.BaseChatAgent.produced_message_types"><code class="xref py py-attr docutils literal notranslate"><span class="pre">produced_message_types</span></code></a>.
If streaming is required, also implement the <a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.on_messages_stream" title="agentopera.chatflow.agents.BaseChatAgent.on_messages_stream"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages_stream()</span></code></a> method.</p>
<p>An agent is considered stateful and maintains its state between calls to
the <a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.on_messages" title="agentopera.chatflow.agents.BaseChatAgent.on_messages"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages()</span></code></a> or <a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.on_messages_stream" title="agentopera.chatflow.agents.BaseChatAgent.on_messages_stream"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages_stream()</span></code></a> methods.
The agent should store its state in the
agent instance. The agent should also implement the <a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.on_reset" title="agentopera.chatflow.agents.BaseChatAgent.on_reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_reset()</span></code></a> method
to reset the agent to its initialization state.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The caller should only pass the new messages to the agent on each call
to the <a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.on_messages" title="agentopera.chatflow.agents.BaseChatAgent.on_messages"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages()</span></code></a> or <a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.on_messages_stream" title="agentopera.chatflow.agents.BaseChatAgent.on_messages_stream"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages_stream()</span></code></a> method.
Do not pass the entire conversation history to the agent on each call.
This design principle must be followed when creating a new agent.</p>
</div>
<dl class="py property">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.BaseChatAgent.name">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">name</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#agentopera.chatflow.agents.BaseChatAgent.name" title="Link to this definition"></a></dt>
<dd><p>The name of the agent. This is used by team to uniquely identify
the agent. It should be unique within the team.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.BaseChatAgent.description">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">description</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#agentopera.chatflow.agents.BaseChatAgent.description" title="Link to this definition"></a></dt>
<dd><p>The description of the agent. This is used by team to
make decisions about which agents to use. The description should
describe the agent’s capabilities and how to interact with it.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.BaseChatAgent.produced_message_types">
<em class="property"><span class="pre">abstract</span><span class="w"> </span><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">produced_message_types</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">type</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#agentopera.chatflow.agents.BaseChatAgent.produced_message_types" title="Link to this definition"></a></dt>
<dd><p>The types of messages that the agent produces in the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Response.chat_message</span></code> field. They must be <code class="xref py py-class docutils literal notranslate"><span class="pre">ChatMessage</span></code> types.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.BaseChatAgent.on_messages">
<em class="property"><span class="pre">abstract</span><span class="w"> </span><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">on_messages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">messages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response" title="agentopera.chatflow.base.chat_agent.Response"><span class="pre">Response</span></a></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/base_chat_agent.html#BaseChatAgent.on_messages"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.BaseChatAgent.on_messages" title="Link to this definition"></a></dt>
<dd><p>Handles incoming messages and returns a response.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Agents are stateful and the messages passed to this method should
be the new messages since the last call to this method. The agent
should maintain its state between calls to this method. For example,
if the agent needs to remember the previous messages to respond to
the current message, it should store the previous messages in the
agent state.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.BaseChatAgent.on_messages_stream">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">on_messages_stream</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">messages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">AsyncGenerator</span><span class="p"><span class="pre">[</span></span><span class="pre">ToolCallRequestEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallExecutionEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MemoryQueryEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">UserInputRequestedEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ModelClientStreamingChunkEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ThoughtEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response" title="agentopera.chatflow.base.chat_agent.Response"><span class="pre">Response</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/base_chat_agent.html#BaseChatAgent.on_messages_stream"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.BaseChatAgent.on_messages_stream" title="Link to this definition"></a></dt>
<dd><p>Handles incoming messages and returns a stream of messages and
and the final item is the response. The base implementation in
<a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent" title="agentopera.chatflow.agents.BaseChatAgent"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseChatAgent</span></code></a> simply calls <a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.on_messages" title="agentopera.chatflow.agents.BaseChatAgent.on_messages"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages()</span></code></a> and yields
the messages in the response.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Agents are stateful and the messages passed to this method should
be the new messages since the last call to this method. The agent
should maintain its state between calls to this method. For example,
if the agent needs to remember the previous messages to respond to
the current message, it should store the previous messages in the
agent state.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.BaseChatAgent.run">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.TaskResult" title="agentopera.chatflow.base.task.TaskResult"><span class="pre">TaskResult</span></a></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/base_chat_agent.html#BaseChatAgent.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.BaseChatAgent.run" title="Link to this definition"></a></dt>
<dd><p>Run the agent with the given task and return the result.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.BaseChatAgent.run_stream">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">run_stream</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">AsyncGenerator</span><span class="p"><span class="pre">[</span></span><span class="pre">ToolCallRequestEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallExecutionEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MemoryQueryEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">UserInputRequestedEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ModelClientStreamingChunkEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ThoughtEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.TaskResult" title="agentopera.chatflow.base.task.TaskResult"><span class="pre">TaskResult</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/base_chat_agent.html#BaseChatAgent.run_stream"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.BaseChatAgent.run_stream" title="Link to this definition"></a></dt>
<dd><p>Run the agent with the given task and return a stream of messages
and the final task result as the last item in the stream.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.BaseChatAgent.on_reset">
<em class="property"><span class="pre">abstract</span><span class="w"> </span><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">on_reset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/base_chat_agent.html#BaseChatAgent.on_reset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.BaseChatAgent.on_reset" title="Link to this definition"></a></dt>
<dd><p>Resets the agent to its initialization state.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.BaseChatAgent.save_state">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">save_state</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/base_chat_agent.html#BaseChatAgent.save_state"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.BaseChatAgent.save_state" title="Link to this definition"></a></dt>
<dd><p>Export state. Default implementation for stateless agents.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.BaseChatAgent.load_state">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load_state</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/base_chat_agent.html#BaseChatAgent.load_state"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.BaseChatAgent.load_state" title="Link to this definition"></a></dt>
<dd><p>Restore agent from saved state. Default implementation for stateless agents.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.BaseChatAgent.close">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/base_chat_agent.html#BaseChatAgent.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.BaseChatAgent.close" title="Link to this definition"></a></dt>
<dd><p>Called when the engine is closed</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.BaseChatAgent.agent_identifier">
<span class="sig-name descname"><span class="pre">agent_identifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">agent_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/base_chat_agent.html#BaseChatAgent.agent_identifier"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.BaseChatAgent.agent_identifier" title="Link to this definition"></a></dt>
<dd><p>Returns the identifier of the agent.
:param agent_name: Input string
:return: True if valid, False otherwise</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.AssistantAgent">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">agentopera.chatflow.agents.</span></span><span class="sig-name descname"><span class="pre">AssistantAgent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_client</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ChatCompletionClient</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tools</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../engine/engine.function_call.html#agentopera.engine.function_call.BaseTool" title="agentopera.engine.function_call.base.BaseTool"><span class="pre">BaseTool</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Awaitable</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">handoffs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Handoff" title="agentopera.chatflow.base.handoff.Handoff"><span class="pre">Handoff</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ChatCompletionContext</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'An</span> <span class="pre">agent</span> <span class="pre">that</span> <span class="pre">provides</span> <span class="pre">assistance</span> <span class="pre">with</span> <span class="pre">ability</span> <span class="pre">to</span> <span class="pre">use</span> <span class="pre">tools.'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">system_message</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'You</span> <span class="pre">are</span> <span class="pre">a</span> <span class="pre">helpful</span> <span class="pre">AI</span> <span class="pre">assistant.</span> <span class="pre">Solve</span> <span class="pre">tasks</span> <span class="pre">using</span> <span class="pre">your</span> <span class="pre">tools.</span> <span class="pre">Reply</span> <span class="pre">with</span> <span class="pre">TERMINATE</span> <span class="pre">when</span> <span class="pre">the</span> <span class="pre">task</span> <span class="pre">has</span> <span class="pre">been</span> <span class="pre">completed.'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_client_stream</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflect_on_tool_use</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tool_call_summary_format</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'{result}'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">memory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../memory/memory.html#agentopera.memory.Memory" title="agentopera.memory.base_memory.Memory"><span class="pre">Memory</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/assistant_agent.html#AssistantAgent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.AssistantAgent" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent" title="agentopera.chatflow.agents.base_chat_agent.BaseChatAgent"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseChatAgent</span></code></a></p>
<p>An agent that provides assistance with tool use.</p>
<p>The <a class="reference internal" href="#agentopera.chatflow.agents.AssistantAgent.on_messages" title="agentopera.chatflow.agents.AssistantAgent.on_messages"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages()</span></code></a> returns a <a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response" title="agentopera.chatflow.base.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a>
in which <a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response.chat_message" title="agentopera.chatflow.base.Response.chat_message"><code class="xref py py-attr docutils literal notranslate"><span class="pre">chat_message</span></code></a> is the final
response message.</p>
<p>The <a class="reference internal" href="#agentopera.chatflow.agents.AssistantAgent.on_messages_stream" title="agentopera.chatflow.agents.AssistantAgent.on_messages_stream"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages_stream()</span></code></a> creates an async generator that produces
the inner messages as they are created, and the <a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response" title="agentopera.chatflow.base.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a>
object as the last item before closing the generator.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The caller must only pass the new messages to the agent on each call
to the <a class="reference internal" href="#agentopera.chatflow.agents.AssistantAgent.on_messages" title="agentopera.chatflow.agents.AssistantAgent.on_messages"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages()</span></code></a> or <a class="reference internal" href="#agentopera.chatflow.agents.AssistantAgent.on_messages_stream" title="agentopera.chatflow.agents.AssistantAgent.on_messages_stream"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages_stream()</span></code></a> method.
The agent maintains its state between calls to these methods.
Do not pass the entire conversation history to the agent on each call.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The assistant agent is not thread-safe or coroutine-safe.
It should not be shared between multiple tasks or coroutines, and it should
not call its methods concurrently.</p>
</div>
<p>The following diagram shows how the assistant agent works:</p>
<p>Tool call behavior:</p>
<ul class="simple">
<li><p>If the model returns no tool call, then the response is immediately returned as a <code class="xref py py-class docutils literal notranslate"><span class="pre">TextMessage</span></code> in <a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response.chat_message" title="agentopera.chatflow.base.Response.chat_message"><code class="xref py py-attr docutils literal notranslate"><span class="pre">chat_message</span></code></a>.</p></li>
<li><dl class="simple">
<dt>When the model returns tool calls, they will be executed right away:</dt><dd><ul>
<li><p>When <cite>reflect_on_tool_use</cite> is False (default), the tool call results are returned as a <code class="xref py py-class docutils literal notranslate"><span class="pre">ToolCallSummaryMessage</span></code> in <a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response.chat_message" title="agentopera.chatflow.base.Response.chat_message"><code class="xref py py-attr docutils literal notranslate"><span class="pre">chat_message</span></code></a>. <cite>tool_call_summary_format</cite> can be used to customize the tool call summary.</p></li>
<li><p>When <cite>reflect_on_tool_use</cite> is True, the another model inference is made using the tool calls and results, and the text response is returned as a <code class="xref py py-class docutils literal notranslate"><span class="pre">TextMessage</span></code> in <a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response.chat_message" title="agentopera.chatflow.base.Response.chat_message"><code class="xref py py-attr docutils literal notranslate"><span class="pre">chat_message</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>If the model returns multiple tool calls, they will be executed concurrently. To disable parallel tool calls you need to configure the model client. For example, set <cite>parallel_tool_calls=False</cite> for <code class="xref py py-class docutils literal notranslate"><span class="pre">OpenAIChatCompletionClient</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">AzureOpenAIChatCompletionClient</span></code>.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>By default, the tool call results are returned as response when tool calls are made.
So it is recommended to pay attention to the formatting of the tools return values,
especially if another agent is expecting them in a specific format.
Use <cite>tool_call_summary_format</cite> to customize the tool call summary, if needed.</p>
</div>
<p>Hand off behavior:</p>
<ul class="simple">
<li><p>If a handoff is triggered, a <code class="xref py py-class docutils literal notranslate"><span class="pre">HandoffMessage</span></code> will be returned in <a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response.chat_message" title="agentopera.chatflow.base.Response.chat_message"><code class="xref py py-attr docutils literal notranslate"><span class="pre">chat_message</span></code></a>.</p></li>
<li><p>If there are tool calls, they will also be executed right away before returning the handoff.</p></li>
<li><p>The tool calls and results are passed to the target agent through <code class="xref py py-attr docutils literal notranslate"><span class="pre">context</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If multiple handoffs are detected, only the first handoff is executed.
To avoid this, disable parallel tool calls in the model client configuration.</p>
</div>
<p>Limit context size sent to the model:</p>
<p>You can limit the number of messages sent to the model by setting
the <cite>model_context</cite> parameter to a <code class="xref py py-class docutils literal notranslate"><span class="pre">BufferedChatCompletionContext</span></code>.
This will limit the number of recent messages sent to the model and can be useful
when the model has a limit on the number of tokens it can process.
You can also create your own model context by subclassing
<code class="xref py py-class docutils literal notranslate"><span class="pre">ChatCompletionContext</span></code>.</p>
<p>Streaming mode:</p>
<p>The assistant agent can be used in streaming mode by setting <cite>model_client_stream=True</cite>.
In this mode, the <a class="reference internal" href="#agentopera.chatflow.agents.AssistantAgent.on_messages_stream" title="agentopera.chatflow.agents.AssistantAgent.on_messages_stream"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages_stream()</span></code></a> and <a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.run_stream" title="agentopera.chatflow.agents.BaseChatAgent.run_stream"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BaseChatAgent.run_stream()</span></code></a> methods will also yield
<code class="xref py py-class docutils literal notranslate"><span class="pre">ModelClientStreamingChunkEvent</span></code>
messages as the model client produces chunks of response.
The chunk messages will not be included in the final response’s inner messages.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – The name of the agent.</p></li>
<li><p><strong>model_client</strong> (<em>ChatCompletionClient</em>) – The model client to use for inference.</p></li>
<li><p><strong>tools</strong> (<em>List</em><em>[</em><a class="reference internal" href="../engine/engine.function_call.html#agentopera.engine.function_call.BaseTool" title="agentopera.engine.function_call.BaseTool"><em>BaseTool</em></a><em>[</em><em>Any</em><em>, </em><em>Any</em><em>]  </em><em>| </em><em>Callable</em><em>[</em><em>...</em><em>, </em><em>Any</em><em>] </em><em>| </em><em>Callable</em><em>[</em><em>...</em><em>, </em><em>Awaitable</em><em>[</em><em>Any</em><em>]</em><em>]</em><em>] </em><em>| </em><em>None</em><em>, </em><em>optional</em>) – The tools to register with the agent.</p></li>
<li><p><strong>handoffs</strong> (<em>List</em><em>[</em><em>HandoffBase</em><em> | </em><em>str</em><em>] </em><em>| </em><em>None</em><em>, </em><em>optional</em>) – The handoff configurations for the agent,
allowing it to transfer to other agents by responding with a <code class="xref py py-class docutils literal notranslate"><span class="pre">HandoffMessage</span></code>.
The transfer is only executed when the team is in <code class="xref py py-class docutils literal notranslate"><span class="pre">Swarm</span></code>.
If a handoff is a string, it should represent the target agent’s name.</p></li>
<li><p><strong>model_context</strong> (<em>ChatCompletionContext</em><em> | </em><em>None</em><em>, </em><em>optional</em>) – The model context for storing and retrieving <code class="xref py py-class docutils literal notranslate"><span class="pre">LLMMessage</span></code>. It can be preloaded with initial messages. The initial messages will be cleared when the agent is reset.</p></li>
<li><p><strong>description</strong> (<em>str</em><em>, </em><em>optional</em>) – The description of the agent.</p></li>
<li><p><strong>system_message</strong> (<em>str</em><em>, </em><em>optional</em>) – The system message for the model. If provided, it will be prepended to the messages in the model context when making an inference. Set to <cite>None</cite> to disable.</p></li>
<li><p><strong>model_client_stream</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, the model client will be used in streaming mode.
<a class="reference internal" href="#agentopera.chatflow.agents.AssistantAgent.on_messages_stream" title="agentopera.chatflow.agents.AssistantAgent.on_messages_stream"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages_stream()</span></code></a> and <a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent.run_stream" title="agentopera.chatflow.agents.BaseChatAgent.run_stream"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BaseChatAgent.run_stream()</span></code></a> methods will also yield <code class="xref py py-class docutils literal notranslate"><span class="pre">ModelClientStreamingChunkEvent</span></code>
messages as the model client produces chunks of response. Defaults to <cite>False</cite>.</p></li>
<li><p><strong>reflect_on_tool_use</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, the agent will make another model inference using the tool call and result
to generate a response. If <cite>False</cite>, the tool call result will be returned as the response. Defaults to <cite>False</cite>.</p></li>
<li><p><strong>tool_call_summary_format</strong> (<em>str</em><em>, </em><em>optional</em>) – The format string used to create a tool call summary for every tool call result.
Defaults to “{result}”.
When <cite>reflect_on_tool_use</cite> is <cite>False</cite>, a concatenation of all the tool call summaries, separated by a new line character (’n’)
will be returned as the response.
Available variables: <cite>{tool_name}</cite>, <cite>{arguments}</cite>, <cite>{result}</cite>.
For example, <cite>“{tool_name}: {result}”</cite> will create a summary like <cite>“tool_name: result”</cite>.</p></li>
<li><p><strong>memory</strong> (<em>Sequence</em><em>[</em><a class="reference internal" href="../memory/memory.html#agentopera.memory.Memory" title="agentopera.memory.Memory"><em>Memory</em></a><em>] </em><em>| </em><em>None</em><em>, </em><em>optional</em>) – The memory store to use for the agent. Defaults to <cite>None</cite>.</p></li>
<li><p><strong>user_context</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, the user history messages will be included in the model context. Defaults to <cite>True</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError</strong> – If tool names are not unique.</p></li>
<li><p><strong>ValueError</strong> – If handoff names are not unique.</p></li>
<li><p><strong>ValueError</strong> – If handoff names are not unique from tool names.</p></li>
<li><p><strong>ValueError</strong> – If maximum number of tool iterations is less than 1.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<p><strong>Example 1: basic agent</strong></p>
<p>The following example demonstrates how to create an assistant agent with
a model client and generate a response to a simple task.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">CancellationToken</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.models.openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIChatCompletionClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssistantAgent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextMessage</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">model_client</span> <span class="o">=</span> <span class="n">OpenAIChatCompletionClient</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span>
        <span class="c1"># api_key = &quot;your_openai_api_key&quot;</span>
    <span class="p">)</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">AssistantAgent</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">on_messages</span><span class="p">(</span>
        <span class="p">[</span><span class="n">TextMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;What is the capital of France?&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)],</span> <span class="n">CancellationToken</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p><strong>Example 2: model client token streaming</strong></p>
<p>This example demonstrates how to create an assistant agent with
a model client and generate a token stream by setting <cite>model_client_stream=True</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.models.openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIChatCompletionClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssistantAgent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">CancellationToken</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">model_client</span> <span class="o">=</span> <span class="n">OpenAIChatCompletionClient</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span>
        <span class="c1"># api_key = &quot;your_openai_api_key&quot;</span>
    <span class="p">)</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">AssistantAgent</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
        <span class="n">model_client_stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">stream</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">on_messages_stream</span><span class="p">(</span>
        <span class="p">[</span><span class="n">TextMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;Name two cities in North America.&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)],</span> <span class="n">CancellationToken</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>source=&#39;assistant&#39; models_usage=None content=&#39;Two&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; cities&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; in&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; North&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; America&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; are&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; New&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; York&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; City&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; in&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; the&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; United&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; States&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; and&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; Toronto&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; in&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; Canada&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39;.&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39; TERMIN&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
source=&#39;assistant&#39; models_usage=None content=&#39;ATE&#39; type=&#39;ModelClientStreamingChunkEvent&#39;
Response(chat_message=TextMessage(source=&#39;assistant&#39;, models_usage=RequestUsage(prompt_tokens=0, completion_tokens=0), content=&#39;Two cities in North America are New York City in the United States and Toronto in Canada. TERMINATE&#39;, type=&#39;TextMessage&#39;), inner_messages=[])
</pre></div>
</div>
<p><strong>Example 3: agent with tools</strong></p>
<p>The following example demonstrates how to create an assistant agent with
a model client and a tool, generate a stream of messages for a task, and
print the messages to the console using <a class="reference internal" href="chatflow.ui.html#agentopera.chatflow.ui.Console" title="agentopera.chatflow.ui.Console"><code class="xref py py-class docutils literal notranslate"><span class="pre">Console</span></code></a>.</p>
<p>The tool is a simple function that returns the current time.
Under the hood, the function is wrapped in a <code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionTool</span></code>
and used with the agent’s model client. The doc string of the function
is used as the tool description, the function name is used as the tool name,
and the function signature including the type hints is used as the tool arguments.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.models.openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIChatCompletionClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssistantAgent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.ui</span><span class="w"> </span><span class="kn">import</span> <span class="n">Console</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">CancellationToken</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_current_time</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;The current time is 12:00 PM.&quot;</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">model_client</span> <span class="o">=</span> <span class="n">OpenAIChatCompletionClient</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span>
        <span class="c1"># api_key = &quot;your_openai_api_key&quot;</span>
    <span class="p">)</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">AssistantAgent</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">get_current_time</span><span class="p">])</span>

    <span class="k">await</span> <span class="n">Console</span><span class="p">(</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">on_messages_stream</span><span class="p">(</span>
            <span class="p">[</span><span class="n">TextMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;What is the current time?&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)],</span> <span class="n">CancellationToken</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="p">)</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p><strong>Example 4: agent with structured output and tool</strong></p>
<p>The following example demonstrates how to create an assistant agent with
a model client configured to use structured output and a tool.
Note that you need to use <code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionTool</span></code> to create the tool
and the <cite>strict=True</cite> is required for structured output mode.
Because the model is configured to use structured output, the output
reflection response will be a JSON formatted string.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssistantAgent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.ui</span><span class="w"> </span><span class="kn">import</span> <span class="n">Console</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">CancellationToken</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">FunctionTool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.models.openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIChatCompletionClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>


<span class="c1"># Define the structured output format.</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AgentResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">thoughts</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">response</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;happy&quot;</span><span class="p">,</span> <span class="s2">&quot;sad&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">]</span>


<span class="c1"># Define the function to be called as a tool.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sentiment_analysis</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a text, return the sentiment.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;happy&quot;</span> <span class="k">if</span> <span class="s2">&quot;happy&quot;</span> <span class="ow">in</span> <span class="n">text</span> <span class="k">else</span> <span class="s2">&quot;sad&quot;</span> <span class="k">if</span> <span class="s2">&quot;sad&quot;</span> <span class="ow">in</span> <span class="n">text</span> <span class="k">else</span> <span class="s2">&quot;neutral&quot;</span>


<span class="c1"># Create a FunctionTool instance with `strict=True`,</span>
<span class="c1"># which is required for structured output mode.</span>
<span class="n">tool</span> <span class="o">=</span> <span class="n">FunctionTool</span><span class="p">(</span><span class="n">sentiment_analysis</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Sentiment Analysis&quot;</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Create an OpenAIChatCompletionClient instance that uses the structured output format.</span>
<span class="n">model_client</span> <span class="o">=</span> <span class="n">OpenAIChatCompletionClient</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o-mini&quot;</span><span class="p">,</span>
    <span class="n">response_format</span><span class="o">=</span><span class="n">AgentResponse</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
<span class="p">)</span>

<span class="c1"># Create an AssistantAgent instance that uses the tool and model client.</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">AssistantAgent</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
    <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">tool</span><span class="p">],</span>
    <span class="n">system_message</span><span class="o">=</span><span class="s2">&quot;Use the tool to analyze sentiment.&quot;</span><span class="p">,</span>
    <span class="n">reflect_on_tool_use</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Use reflection to have the agent generate a formatted response.</span>
<span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">stream</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">on_messages_stream</span><span class="p">([</span><span class="n">TextMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;I am happy today!&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)],</span> <span class="n">CancellationToken</span><span class="p">())</span>
    <span class="k">await</span> <span class="n">Console</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>---------- assistant ----------
[FunctionCall(id=&#39;call_tIZjAVyKEDuijbBwLY6RHV2p&#39;, arguments=&#39;{&quot;text&quot;:&quot;I am happy today!&quot;}&#39;, name=&#39;sentiment_analysis&#39;)]
---------- assistant ----------
[FunctionExecutionResult(content=&#39;happy&#39;, call_id=&#39;call_tIZjAVyKEDuijbBwLY6RHV2p&#39;, is_error=False)]
---------- assistant ----------
{&quot;thoughts&quot;:&quot;The user expresses a clear positive emotion by stating they are happy today, suggesting an upbeat mood.&quot;,&quot;response&quot;:&quot;happy&quot;}
</pre></div>
</div>
<p><strong>Example 5: agent with bounded model context</strong></p>
<p>The following example shows how to use a
<code class="xref py py-class docutils literal notranslate"><span class="pre">BufferedChatCompletionContext</span></code>
that only keeps the last 2 messages (1 user + 1 assistant).
Bounded model context is useful when the model has a limit on the
number of tokens it can process.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssistantAgent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">CancellationToken</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.core.model_context</span><span class="w"> </span><span class="kn">import</span> <span class="n">BufferedChatCompletionContext</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.models.openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIChatCompletionClient</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Create a model client.</span>
    <span class="n">model_client</span> <span class="o">=</span> <span class="n">OpenAIChatCompletionClient</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o-mini&quot;</span><span class="p">,</span>
        <span class="c1"># api_key = &quot;your_openai_api_key&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Create a model context that only keeps the last 2 messages (1 user + 1 assistant).</span>
    <span class="n">model_context</span> <span class="o">=</span> <span class="n">BufferedChatCompletionContext</span><span class="p">(</span><span class="n">buffer_size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Create an AssistantAgent instance with the model client and context.</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">AssistantAgent</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
        <span class="n">model_context</span><span class="o">=</span><span class="n">model_context</span><span class="p">,</span>
        <span class="n">system_message</span><span class="o">=</span><span class="s2">&quot;You are a helpful assistant.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">on_messages</span><span class="p">(</span>
        <span class="p">[</span><span class="n">TextMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;Name two cities in North America.&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)],</span> <span class="n">CancellationToken</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">chat_message</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">on_messages</span><span class="p">(</span>
        <span class="p">[</span><span class="n">TextMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;My favorite color is blue.&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)],</span> <span class="n">CancellationToken</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">chat_message</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">on_messages</span><span class="p">(</span>
        <span class="p">[</span><span class="n">TextMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;Did I ask you any question?&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)],</span> <span class="n">CancellationToken</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">chat_message</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>  <span class="c1"># type: ignore</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Two cities in North America are New York City and Toronto.
That&#39;s great! Blue is often associated with calmness and serenity. Do you have a specific shade of blue that you like, or any particular reason why it&#39;s your favorite?
No, you didn&#39;t ask a question. I apologize for any misunderstanding. If you have something specific you&#39;d like to discuss or ask, feel free to let me know!
</pre></div>
</div>
<p><strong>Example 6: agent with memory</strong></p>
<p>The following example shows how to use a list-based memory with the assistant agent.
The memory is preloaded with some initial content.
Under the hood, the memory is used to update the model context
before making an inference, using the <code class="xref py py-meth docutils literal notranslate"><span class="pre">update_context()</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssistantAgent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">CancellationToken</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.core.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ListMemory</span><span class="p">,</span> <span class="n">MemoryContent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.models.openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIChatCompletionClient</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Create a model client.</span>
    <span class="n">model_client</span> <span class="o">=</span> <span class="n">OpenAIChatCompletionClient</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o-mini&quot;</span><span class="p">,</span>
        <span class="c1"># api_key = &quot;your_openai_api_key&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Create a list-based memory with some initial content.</span>
    <span class="n">memory</span> <span class="o">=</span> <span class="n">ListMemory</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">memory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MemoryContent</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;User likes pizza.&quot;</span><span class="p">,</span> <span class="n">mime_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">))</span>
    <span class="k">await</span> <span class="n">memory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MemoryContent</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;User dislikes cheese.&quot;</span><span class="p">,</span> <span class="n">mime_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">))</span>

    <span class="c1"># Create an AssistantAgent instance with the model client and memory.</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">AssistantAgent</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
        <span class="n">memory</span><span class="o">=</span><span class="p">[</span><span class="n">memory</span><span class="p">],</span>
        <span class="n">system_message</span><span class="o">=</span><span class="s2">&quot;You are a helpful assistant.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">on_messages</span><span class="p">(</span>
        <span class="p">[</span><span class="n">TextMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;One idea for a dinner.&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)],</span> <span class="n">CancellationToken</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">chat_message</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>  <span class="c1"># type: ignore</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>How about making a delicious pizza without cheese? You can create a flavorful veggie pizza with a variety of toppings. Here&#39;s a quick idea:

**Veggie Tomato Sauce Pizza**
- Start with a pizza crust (store-bought or homemade).
- Spread a layer of marinara or tomato sauce evenly over the crust.
- Top with your favorite vegetables like bell peppers, mushrooms, onions, olives, and spinach.
- Add some protein if you’d like, such as grilled chicken or pepperoni (ensure it&#39;s cheese-free).
- Sprinkle with herbs like oregano and basil, and maybe a drizzle of olive oil.
- Bake according to the crust instructions until the edges are golden and the veggies are cooked.

Serve it with a side salad or some garlic bread to complete the meal! Enjoy your dinner!
</pre></div>
</div>
<p><strong>Example 7: agent with `o1-mini`</strong></p>
<p>The following example shows how to use <cite>o1-mini</cite> model with the assistant agent.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">CancellationToken</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.models.openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIChatCompletionClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssistantAgent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextMessage</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">model_client</span> <span class="o">=</span> <span class="n">OpenAIChatCompletionClient</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;o1-mini&quot;</span><span class="p">,</span>
        <span class="c1"># api_key = &quot;your_openai_api_key&quot;</span>
    <span class="p">)</span>
    <span class="c1"># The system message is not supported by the o1 series model.</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">AssistantAgent</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span> <span class="n">system_message</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">on_messages</span><span class="p">(</span>
        <span class="p">[</span><span class="n">TextMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;What is the capital of France?&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)],</span> <span class="n">CancellationToken</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <cite>o1-preview</cite> and <cite>o1-mini</cite> models do not support system message and function calling.
So the <cite>system_message</cite> should be set to <cite>None</cite> and the <cite>tools</cite> and <cite>handoffs</cite> should not be set.
See <a class="reference external" href="https://platform.openai.com/docs/guides/reasoning#beta-limitations">o1 beta limitations</a> for more details.</p>
</div>
<p><strong>Example 8: agent using reasoning model with custom model context.</strong></p>
<p>The following example shows how to use a reasoning model (DeepSeek R1) with the assistant agent.
The model context is used to filter out the thought field from the assistant message.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssistantAgent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.core.model_context</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnboundedChatCompletionContext</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.core.types.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssistantMessage</span><span class="p">,</span> <span class="n">LLMMessage</span><span class="p">,</span> <span class="n">ModelFamily</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.models.ollama</span><span class="w"> </span><span class="kn">import</span> <span class="n">OllamaChatCompletionClient</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ReasoningModelContext</span><span class="p">(</span><span class="n">UnboundedChatCompletionContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A model context for reasoning models.&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">LLMMessage</span><span class="p">]:</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_messages</span><span class="p">()</span>
        <span class="c1"># Filter out thought field from AssistantMessage.</span>
        <span class="n">messages_out</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">LLMMessage</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">AssistantMessage</span><span class="p">):</span>
                <span class="n">message</span><span class="o">.</span><span class="n">thought</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">messages_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">messages_out</span>


<span class="c1"># Create an instance of the model client for DeepSeek R1 hosted locally on Ollama.</span>
<span class="n">model_client</span> <span class="o">=</span> <span class="n">OllamaChatCompletionClient</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;deepseek-r1:8b&quot;</span><span class="p">,</span>
    <span class="n">model_info</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;vision&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;function_calling&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;json_output&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;family&quot;</span><span class="p">:</span> <span class="n">ModelFamily</span><span class="o">.</span><span class="n">R1</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">AssistantAgent</span><span class="p">(</span>
    <span class="s2">&quot;reasoning_agent&quot;</span><span class="p">,</span>
    <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
    <span class="n">model_context</span><span class="o">=</span><span class="n">ReasoningModelContext</span><span class="p">(),</span>  <span class="c1"># Use the custom model context.</span>
<span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_reasoning_agent</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;What is the capital of France?&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_reasoning_agent</span><span class="p">())</span>
</pre></div>
</div>
<dl class="py property">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.AssistantAgent.produced_message_types">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">produced_message_types</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">type</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#agentopera.chatflow.agents.AssistantAgent.produced_message_types" title="Link to this definition"></a></dt>
<dd><p>The types of messages that the agent produces in the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Response.chat_message</span></code> field. They must be <code class="xref py py-class docutils literal notranslate"><span class="pre">ChatMessage</span></code> types.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.AssistantAgent.add_tools">
<span class="sig-name descname"><span class="pre">add_tools</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tools</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../engine/engine.function_call.html#agentopera.engine.function_call.BaseTool" title="agentopera.engine.function_call.base.BaseTool"><span class="pre">BaseTool</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Awaitable</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/assistant_agent.html#AssistantAgent.add_tools"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.AssistantAgent.add_tools" title="Link to this definition"></a></dt>
<dd><p>Adds tools to the agent, ensuring they are properly validated and unique.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>tools</strong> – A list of tools or functions to be added.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If the tool names are not unique or unsupported tool type.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.AssistantAgent.on_messages">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">on_messages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">messages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response" title="agentopera.chatflow.base.chat_agent.Response"><span class="pre">Response</span></a></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/assistant_agent.html#AssistantAgent.on_messages"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.AssistantAgent.on_messages" title="Link to this definition"></a></dt>
<dd><p>Handles incoming messages and returns a response.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Agents are stateful and the messages passed to this method should
be the new messages since the last call to this method. The agent
should maintain its state between calls to this method. For example,
if the agent needs to remember the previous messages to respond to
the current message, it should store the previous messages in the
agent state.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.AssistantAgent.check_cancelled">
<span class="sig-name descname"><span class="pre">check_cancelled</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">where</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/assistant_agent.html#AssistantAgent.check_cancelled"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.AssistantAgent.check_cancelled" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.AssistantAgent.on_messages_stream">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">on_messages_stream</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">messages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">AsyncGenerator</span><span class="p"><span class="pre">[</span></span><span class="pre">ToolCallRequestEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallExecutionEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MemoryQueryEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">UserInputRequestedEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ModelClientStreamingChunkEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ThoughtEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response" title="agentopera.chatflow.base.chat_agent.Response"><span class="pre">Response</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/assistant_agent.html#AssistantAgent.on_messages_stream"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.AssistantAgent.on_messages_stream" title="Link to this definition"></a></dt>
<dd><p>Process the incoming messages with the assistant agent and yield events/responses as they happen.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.AssistantAgent.on_reset">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">on_reset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/assistant_agent.html#AssistantAgent.on_reset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.AssistantAgent.on_reset" title="Link to this definition"></a></dt>
<dd><p>Reset the assistant agent to its initialization state.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.AssistantAgent.save_state">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">save_state</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/assistant_agent.html#AssistantAgent.save_state"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.AssistantAgent.save_state" title="Link to this definition"></a></dt>
<dd><p>Save the current state of the assistant agent.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.AssistantAgent.load_state">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load_state</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/assistant_agent.html#AssistantAgent.load_state"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.AssistantAgent.load_state" title="Link to this definition"></a></dt>
<dd><p>Load the state of the assistant agent</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.CodeExecutorAgent">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">agentopera.chatflow.agents.</span></span><span class="sig-name descname"><span class="pre">CodeExecutorAgent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">code_executor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CodeExecutor</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'A</span> <span class="pre">computer</span> <span class="pre">terminal</span> <span class="pre">that</span> <span class="pre">performs</span> <span class="pre">no</span> <span class="pre">other</span> <span class="pre">action</span> <span class="pre">than</span> <span class="pre">running</span> <span class="pre">Python</span> <span class="pre">scripts</span> <span class="pre">(provided</span> <span class="pre">to</span> <span class="pre">it</span> <span class="pre">quoted</span> <span class="pre">in</span> <span class="pre">```python</span> <span class="pre">code</span> <span class="pre">blocks),</span> <span class="pre">or</span> <span class="pre">sh</span> <span class="pre">shell</span> <span class="pre">scripts</span> <span class="pre">(provided</span> <span class="pre">to</span> <span class="pre">it</span> <span class="pre">quoted</span> <span class="pre">in</span> <span class="pre">```sh</span> <span class="pre">code</span> <span class="pre">blocks).'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/agentopera/agents/code_executor/code_executor_agent.html#CodeExecutorAgent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.CodeExecutorAgent" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent" title="agentopera.chatflow.agents.base_chat_agent.BaseChatAgent"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseChatAgent</span></code></a></p>
<p>An agent that extracts and executes code snippets found in received messages and returns the output.</p>
<p>It is typically used within a team with another agent that generates code snippets to be executed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Consider <code class="xref py py-class docutils literal notranslate"><span class="pre">PythonCodeExecutionTool</span></code>
as an alternative to this agent. The tool allows for executing Python code
within a single agent, rather than sending it to a separate agent for execution.
However, the model for the agent will have to generate properly escaped code
string as a parameter to the tool.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – The name of the agent.</p></li>
<li><p><strong>code_executor</strong> – The CodeExecutor responsible for executing code received in messages (<code class="xref py py-class docutils literal notranslate"><span class="pre">DockerCommandLineCodeExecutor</span></code> recommended. See example below)</p></li>
<li><p><strong>description</strong> (<em>optional</em>) – The description of the agent.</p></li>
<li><p><strong>sources</strong> (<em>optional</em>) – Check only messages from the specified agents for the code to execute.</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is recommended that the <cite>CodeExecutorAgent</cite> agent uses a Docker container to execute code. This ensures that model-generated code is executed in an isolated environment. To use Docker, your environment must have Docker installed and running.
Follow the installation instructions for <a class="reference external" href="https://docs.docker.com/get-docker/">Docker</a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The code executor only processes code that is properly formatted in markdown code blocks using triple backticks.
For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>```python
print(&quot;Hello World&quot;)
```

# or

```sh
echo &quot;Hello World&quot;
```
</pre></div>
</div>
</div>
<p>In this example, we show how to set up a <cite>CodeExecutorAgent</cite> agent that uses the
<code class="xref py py-class docutils literal notranslate"><span class="pre">DockerCommandLineCodeExecutor</span></code>
to execute code snippets in a Docker container. The <cite>work_dir</cite> parameter indicates where all executed files are first saved locally before being executed in the Docker container.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">CodeExecutorAgent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.agents.code_executors.docker</span><span class="w"> </span><span class="kn">import</span> <span class="n">DockerCommandLineCodeExecutor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">CancellationToken</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_code_executor_agent</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Create a code executor agent that uses a Docker container to execute code.</span>
    <span class="n">code_executor</span> <span class="o">=</span> <span class="n">DockerCommandLineCodeExecutor</span><span class="p">(</span><span class="n">work_dir</span><span class="o">=</span><span class="s2">&quot;coding&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">code_executor</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">code_executor_agent</span> <span class="o">=</span> <span class="n">CodeExecutorAgent</span><span class="p">(</span><span class="s2">&quot;code_executor&quot;</span><span class="p">,</span> <span class="n">code_executor</span><span class="o">=</span><span class="n">code_executor</span><span class="p">)</span>

    <span class="c1"># Run the agent with a given code snippet.</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">TextMessage</span><span class="p">(</span>
        <span class="n">content</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;Here is some code</span>
<span class="s1">```python</span>
<span class="s1">print(&#39;Hello world&#39;)</span>
<span class="s1">```</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">code_executor_agent</span><span class="o">.</span><span class="n">on_messages</span><span class="p">([</span><span class="n">task</span><span class="p">],</span> <span class="n">CancellationToken</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">chat_message</span><span class="p">)</span>

    <span class="c1"># Stop the code executor.</span>
    <span class="k">await</span> <span class="n">code_executor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_code_executor_agent</span><span class="p">())</span>
</pre></div>
</div>
</div></blockquote>
<dl class="py property">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.CodeExecutorAgent.produced_message_types">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">produced_message_types</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">type</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#agentopera.chatflow.agents.CodeExecutorAgent.produced_message_types" title="Link to this definition"></a></dt>
<dd><p>The types of messages that the code executor agent produces.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.CodeExecutorAgent.on_messages">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">on_messages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">messages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response" title="agentopera.chatflow.base.chat_agent.Response"><span class="pre">Response</span></a></span></span><a class="reference internal" href="../_modules/agentopera/agents/code_executor/code_executor_agent.html#CodeExecutorAgent.on_messages"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.CodeExecutorAgent.on_messages" title="Link to this definition"></a></dt>
<dd><p>Handles incoming messages and returns a response.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Agents are stateful and the messages passed to this method should
be the new messages since the last call to this method. The agent
should maintain its state between calls to this method. For example,
if the agent needs to remember the previous messages to respond to
the current message, it should store the previous messages in the
agent state.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.CodeExecutorAgent.on_reset">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">on_reset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/agentopera/agents/code_executor/code_executor_agent.html#CodeExecutorAgent.on_reset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.CodeExecutorAgent.on_reset" title="Link to this definition"></a></dt>
<dd><p>It it’s a no-op as the code executor agent has no mutable state.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.SocietyOfMindAgent">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">agentopera.chatflow.agents.</span></span><span class="sig-name descname"><span class="pre">SocietyOfMindAgent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">team</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Team" title="agentopera.chatflow.base.team.Team"><span class="pre">Team</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_client</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ChatCompletionClient</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'An</span> <span class="pre">agent</span> <span class="pre">that</span> <span class="pre">uses</span> <span class="pre">an</span> <span class="pre">inner</span> <span class="pre">team</span> <span class="pre">of</span> <span class="pre">agents</span> <span class="pre">to</span> <span class="pre">generate</span> <span class="pre">responses.'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instruction</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Earlier</span> <span class="pre">you</span> <span class="pre">were</span> <span class="pre">asked</span> <span class="pre">to</span> <span class="pre">fulfill</span> <span class="pre">a</span> <span class="pre">request.</span> <span class="pre">You</span> <span class="pre">and</span> <span class="pre">your</span> <span class="pre">team</span> <span class="pre">worked</span> <span class="pre">diligently</span> <span class="pre">to</span> <span class="pre">address</span> <span class="pre">that</span> <span class="pre">request.</span> <span class="pre">Here</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">transcript</span> <span class="pre">of</span> <span class="pre">that</span> <span class="pre">conversation:'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">response_prompt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Output</span> <span class="pre">a</span> <span class="pre">standalone</span> <span class="pre">response</span> <span class="pre">to</span> <span class="pre">the</span> <span class="pre">original</span> <span class="pre">request,</span> <span class="pre">without</span> <span class="pre">mentioning</span> <span class="pre">any</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">intermediate</span> <span class="pre">discussion.'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/society_of_mind_agent.html#SocietyOfMindAgent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.SocietyOfMindAgent" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent" title="agentopera.chatflow.agents.base_chat_agent.BaseChatAgent"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseChatAgent</span></code></a></p>
<p>An agent that uses an inner team of agents to generate responses.</p>
<p>Each time the agent’s <a class="reference internal" href="#agentopera.chatflow.agents.SocietyOfMindAgent.on_messages" title="agentopera.chatflow.agents.SocietyOfMindAgent.on_messages"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages()</span></code></a> or <a class="reference internal" href="#agentopera.chatflow.agents.SocietyOfMindAgent.on_messages_stream" title="agentopera.chatflow.agents.SocietyOfMindAgent.on_messages_stream"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages_stream()</span></code></a>
method is called, it runs the inner team of agents and then uses the
model client to generate a response based on the inner team’s messages.
Once the response is generated, the agent resets the inner team by
calling <code class="xref py py-meth docutils literal notranslate"><span class="pre">Team.reset()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – The name of the agent.</p></li>
<li><p><strong>team</strong> (<a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Team" title="agentopera.chatflow.base.Team"><em>Team</em></a>) – The team of agents to use.</p></li>
<li><p><strong>model_client</strong> (<em>ChatCompletionClient</em>) – The model client to use for preparing responses.</p></li>
<li><p><strong>description</strong> (<em>str</em><em>, </em><em>optional</em>) – The description of the agent.</p></li>
<li><p><strong>instruction</strong> (<em>str</em><em>, </em><em>optional</em>) – The instruction to use when generating a response using the inner team’s messages.
Defaults to <a class="reference internal" href="#agentopera.chatflow.agents.SocietyOfMindAgent.DEFAULT_INSTRUCTION" title="agentopera.chatflow.agents.SocietyOfMindAgent.DEFAULT_INSTRUCTION"><code class="xref py py-attr docutils literal notranslate"><span class="pre">DEFAULT_INSTRUCTION</span></code></a>. It assumes the role of ‘system’.</p></li>
<li><p><strong>response_prompt</strong> (<em>str</em><em>, </em><em>optional</em>) – The response prompt to use when generating a response using the inner team’s messages.
Defaults to <a class="reference internal" href="#agentopera.chatflow.agents.SocietyOfMindAgent.DEFAULT_RESPONSE_PROMPT" title="agentopera.chatflow.agents.SocietyOfMindAgent.DEFAULT_RESPONSE_PROMPT"><code class="xref py py-attr docutils literal notranslate"><span class="pre">DEFAULT_RESPONSE_PROMPT</span></code></a>. It assumes the role of ‘system’.</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.ui</span><span class="w"> </span><span class="kn">import</span> <span class="n">Console</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssistantAgent</span><span class="p">,</span> <span class="n">SocietyOfMindAgent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.models.openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIChatCompletionClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.teams</span><span class="w"> </span><span class="kn">import</span> <span class="n">RoundRobinGroupChat</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.conditions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextMentionTermination</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">model_client</span> <span class="o">=</span> <span class="n">OpenAIChatCompletionClient</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">)</span>

    <span class="n">agent1</span> <span class="o">=</span> <span class="n">AssistantAgent</span><span class="p">(</span><span class="s2">&quot;assistant1&quot;</span><span class="p">,</span> <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span> <span class="n">system_message</span><span class="o">=</span><span class="s2">&quot;You are a writer, write well.&quot;</span><span class="p">)</span>
    <span class="n">agent2</span> <span class="o">=</span> <span class="n">AssistantAgent</span><span class="p">(</span>
        <span class="s2">&quot;assistant2&quot;</span><span class="p">,</span>
        <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
        <span class="n">system_message</span><span class="o">=</span><span class="s2">&quot;You are an editor, provide critical feedback. Respond with &#39;APPROVE&#39; if the text addresses all feedbacks.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">inner_termination</span> <span class="o">=</span> <span class="n">TextMentionTermination</span><span class="p">(</span><span class="s2">&quot;APPROVE&quot;</span><span class="p">)</span>
    <span class="n">inner_team</span> <span class="o">=</span> <span class="n">RoundRobinGroupChat</span><span class="p">([</span><span class="n">agent1</span><span class="p">,</span> <span class="n">agent2</span><span class="p">],</span> <span class="n">termination_condition</span><span class="o">=</span><span class="n">inner_termination</span><span class="p">)</span>

    <span class="n">society_of_mind_agent</span> <span class="o">=</span> <span class="n">SocietyOfMindAgent</span><span class="p">(</span><span class="s2">&quot;society_of_mind&quot;</span><span class="p">,</span> <span class="n">team</span><span class="o">=</span><span class="n">inner_team</span><span class="p">,</span> <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">)</span>

    <span class="n">agent3</span> <span class="o">=</span> <span class="n">AssistantAgent</span><span class="p">(</span>
        <span class="s2">&quot;assistant3&quot;</span><span class="p">,</span> <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span> <span class="n">system_message</span><span class="o">=</span><span class="s2">&quot;Translate the text to Spanish.&quot;</span>
    <span class="p">)</span>
    <span class="n">team</span> <span class="o">=</span> <span class="n">RoundRobinGroupChat</span><span class="p">([</span><span class="n">society_of_mind_agent</span><span class="p">,</span> <span class="n">agent3</span><span class="p">],</span> <span class="n">max_turns</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">stream</span> <span class="o">=</span> <span class="n">team</span><span class="o">.</span><span class="n">run_stream</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;Write a short story with a surprising ending.&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">Console</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.SocietyOfMindAgent.DEFAULT_INSTRUCTION">
<span class="sig-name descname"><span class="pre">DEFAULT_INSTRUCTION</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'Earlier</span> <span class="pre">you</span> <span class="pre">were</span> <span class="pre">asked</span> <span class="pre">to</span> <span class="pre">fulfill</span> <span class="pre">a</span> <span class="pre">request.</span> <span class="pre">You</span> <span class="pre">and</span> <span class="pre">your</span> <span class="pre">team</span> <span class="pre">worked</span> <span class="pre">diligently</span> <span class="pre">to</span> <span class="pre">address</span> <span class="pre">that</span> <span class="pre">request.</span> <span class="pre">Here</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">transcript</span> <span class="pre">of</span> <span class="pre">that</span> <span class="pre">conversation:'</span></em><a class="headerlink" href="#agentopera.chatflow.agents.SocietyOfMindAgent.DEFAULT_INSTRUCTION" title="Link to this definition"></a></dt>
<dd><p>The default instruction to use when generating a response using the
inner team’s messages. The instruction will be prepended to the inner team’s
messages when generating a response using the model. It assumes the role of
‘system’.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.SocietyOfMindAgent.DEFAULT_RESPONSE_PROMPT">
<span class="sig-name descname"><span class="pre">DEFAULT_RESPONSE_PROMPT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'Output</span> <span class="pre">a</span> <span class="pre">standalone</span> <span class="pre">response</span> <span class="pre">to</span> <span class="pre">the</span> <span class="pre">original</span> <span class="pre">request,</span> <span class="pre">without</span> <span class="pre">mentioning</span> <span class="pre">any</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">intermediate</span> <span class="pre">discussion.'</span></em><a class="headerlink" href="#agentopera.chatflow.agents.SocietyOfMindAgent.DEFAULT_RESPONSE_PROMPT" title="Link to this definition"></a></dt>
<dd><p>The default response prompt to use when generating a response using
the inner team’s messages. It assumes the role of ‘system’.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.SocietyOfMindAgent.DEFAULT_DESCRIPTION">
<span class="sig-name descname"><span class="pre">DEFAULT_DESCRIPTION</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'An</span> <span class="pre">agent</span> <span class="pre">that</span> <span class="pre">uses</span> <span class="pre">an</span> <span class="pre">inner</span> <span class="pre">team</span> <span class="pre">of</span> <span class="pre">agents</span> <span class="pre">to</span> <span class="pre">generate</span> <span class="pre">responses.'</span></em><a class="headerlink" href="#agentopera.chatflow.agents.SocietyOfMindAgent.DEFAULT_DESCRIPTION" title="Link to this definition"></a></dt>
<dd><p>The default description for a SocietyOfMindAgent.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.SocietyOfMindAgent.produced_message_types">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">produced_message_types</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">type</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#agentopera.chatflow.agents.SocietyOfMindAgent.produced_message_types" title="Link to this definition"></a></dt>
<dd><p>The types of messages that the agent produces in the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Response.chat_message</span></code> field. They must be <code class="xref py py-class docutils literal notranslate"><span class="pre">ChatMessage</span></code> types.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.SocietyOfMindAgent.on_messages">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">on_messages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">messages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response" title="agentopera.chatflow.base.chat_agent.Response"><span class="pre">Response</span></a></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/society_of_mind_agent.html#SocietyOfMindAgent.on_messages"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.SocietyOfMindAgent.on_messages" title="Link to this definition"></a></dt>
<dd><p>Handles incoming messages and returns a response.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Agents are stateful and the messages passed to this method should
be the new messages since the last call to this method. The agent
should maintain its state between calls to this method. For example,
if the agent needs to remember the previous messages to respond to
the current message, it should store the previous messages in the
agent state.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.SocietyOfMindAgent.on_messages_stream">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">on_messages_stream</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">messages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">AsyncGenerator</span><span class="p"><span class="pre">[</span></span><span class="pre">ToolCallRequestEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallExecutionEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MemoryQueryEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">UserInputRequestedEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ModelClientStreamingChunkEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ThoughtEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response" title="agentopera.chatflow.base.chat_agent.Response"><span class="pre">Response</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/society_of_mind_agent.html#SocietyOfMindAgent.on_messages_stream"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.SocietyOfMindAgent.on_messages_stream" title="Link to this definition"></a></dt>
<dd><p>Handles incoming messages and returns a stream of messages and
and the final item is the response. The base implementation in
<a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent" title="agentopera.chatflow.agents.BaseChatAgent"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseChatAgent</span></code></a> simply calls <a class="reference internal" href="#agentopera.chatflow.agents.SocietyOfMindAgent.on_messages" title="agentopera.chatflow.agents.SocietyOfMindAgent.on_messages"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_messages()</span></code></a> and yields
the messages in the response.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Agents are stateful and the messages passed to this method should
be the new messages since the last call to this method. The agent
should maintain its state between calls to this method. For example,
if the agent needs to remember the previous messages to respond to
the current message, it should store the previous messages in the
agent state.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.SocietyOfMindAgent.on_reset">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">on_reset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/society_of_mind_agent.html#SocietyOfMindAgent.on_reset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.SocietyOfMindAgent.on_reset" title="Link to this definition"></a></dt>
<dd><p>Resets the agent to its initialization state.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.SocietyOfMindAgent.save_state">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">save_state</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/society_of_mind_agent.html#SocietyOfMindAgent.save_state"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.SocietyOfMindAgent.save_state" title="Link to this definition"></a></dt>
<dd><p>Export state. Default implementation for stateless agents.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.SocietyOfMindAgent.load_state">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load_state</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/society_of_mind_agent.html#SocietyOfMindAgent.load_state"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.SocietyOfMindAgent.load_state" title="Link to this definition"></a></dt>
<dd><p>Restore agent from saved state. Default implementation for stateless agents.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.UserProxyAgent">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">agentopera.chatflow.agents.</span></span><span class="sig-name descname"><span class="pre">UserProxyAgent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'A</span> <span class="pre">human</span> <span class="pre">user'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_func</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Awaitable</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/user_proxy_agent.html#UserProxyAgent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.UserProxyAgent" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#agentopera.chatflow.agents.BaseChatAgent" title="agentopera.chatflow.agents.base_chat_agent.BaseChatAgent"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseChatAgent</span></code></a></p>
<p>An agent that can represent a human user through an input function.</p>
<p>This agent can be used to represent a human user in a chat system by providing a custom input function.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using <a class="reference internal" href="#agentopera.chatflow.agents.UserProxyAgent" title="agentopera.chatflow.agents.UserProxyAgent"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserProxyAgent</span></code></a> puts a running team in a temporary blocked
state until the user responds. So it is important to time out the user input
function and cancel using the <code class="xref py py-class docutils literal notranslate"><span class="pre">CancellationToken</span></code> if the user does not respond.
The input function should also handle exceptions and return a default response if needed.</p>
<p>For typical use cases that involve
slow human responses, it is recommended to use termination conditions
such as <a class="reference internal" href="chatflow.conditions.html#agentopera.chatflow.conditions.HandoffTermination" title="agentopera.chatflow.conditions.HandoffTermination"><code class="xref py py-class docutils literal notranslate"><span class="pre">HandoffTermination</span></code></a> or <a class="reference internal" href="chatflow.conditions.html#agentopera.chatflow.conditions.SourceMatchTermination" title="agentopera.chatflow.conditions.SourceMatchTermination"><code class="xref py py-class docutils literal notranslate"><span class="pre">SourceMatchTermination</span></code></a>
to stop the running team and return the control to the application.
You can run the team again with the user input. This way, the state of the team
can be saved and restored when the user responds.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – The name of the agent.</p></li>
<li><p><strong>description</strong> (<em>str</em><em>, </em><em>optional</em>) – A description of the agent.</p></li>
<li><p><strong>input_func</strong> (<em>Optional</em><em>[</em><em>Callable</em><em>[</em><em>[</em><em>str</em><em>]</em><em>, </em><em>str</em><em>]</em><em>]</em><em>, </em><em>Callable</em><em>[</em><em>[</em><em>str</em><em>, </em><em>Optional</em><em>[</em><a class="reference internal" href="../engine/engine.agent.html#agentopera.engine.agent.CancellationToken" title="agentopera.engine.agent.CancellationToken"><em>CancellationToken</em></a><em>]</em><em>]</em><em>, </em><em>Awaitable</em><em>[</em><em>str</em><em>]</em><em>]</em>) – A function that takes a prompt and returns a user input string.</p></li>
</ul>
</dd>
</dl>
<p>For examples of integrating with web and UI frameworks, see the following:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/FedML-AI/AgentOpera/tree/main/python/samples/agentopera_fastapi">FastAPI</a></p></li>
<li><p><a class="reference external" href="https://github.com/FedML-AI/AgentOpera/tree/main/python/samples/agentopera_chainlit">ChainLit</a></p></li>
</ul>
<p class="rubric">Example</p>
<p>Simple usage case:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">CancellationToken</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserProxyAgent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextMessage</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">simple_user_agent</span><span class="p">():</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">UserProxyAgent</span><span class="p">(</span><span class="s2">&quot;user_proxy&quot;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">on_messages</span><span class="p">(</span>
            <span class="p">[</span><span class="n">TextMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;What is your name? &quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)],</span>
            <span class="n">cancellation_token</span><span class="o">=</span><span class="n">CancellationToken</span><span class="p">(),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your name is </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">chat_message</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<p>Cancellable usage case:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">CancellationToken</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserProxyAgent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentopera.chatflow.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextMessage</span>


<span class="n">token</span> <span class="o">=</span> <span class="n">CancellationToken</span><span class="p">()</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">UserProxyAgent</span><span class="p">(</span><span class="s2">&quot;user_proxy&quot;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">timeout</span><span class="p">(</span><span class="n">delay</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">cancellation_callback</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Task</span><span class="p">[</span><span class="n">Any</span><span class="p">]):</span>
    <span class="n">token</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">cancellable_user_agent</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">timeout_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">timeout</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">timeout_task</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="n">cancellation_callback</span><span class="p">)</span>
        <span class="n">agent_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">on_messages</span><span class="p">(</span>
                <span class="p">[</span><span class="n">TextMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;What is your name? &quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">)],</span>
                <span class="n">cancellation_token</span><span class="o">=</span><span class="n">token</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent_task</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your name is </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">chat_message</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BaseException: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.UserProxyAgent.InputRequestContext">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">InputRequestContext</span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/user_proxy_agent.html#UserProxyAgent.InputRequestContext"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.UserProxyAgent.InputRequestContext" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.UserProxyAgent.InputRequestContext.request_id">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">request_id</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/user_proxy_agent.html#UserProxyAgent.InputRequestContext.request_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.UserProxyAgent.InputRequestContext.request_id" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.UserProxyAgent.produced_message_types">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">produced_message_types</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">type</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#agentopera.chatflow.agents.UserProxyAgent.produced_message_types" title="Link to this definition"></a></dt>
<dd><p>Message types this agent can produce.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.UserProxyAgent.on_messages">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">on_messages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">messages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response" title="agentopera.chatflow.base.chat_agent.Response"><span class="pre">Response</span></a></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/user_proxy_agent.html#UserProxyAgent.on_messages"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.UserProxyAgent.on_messages" title="Link to this definition"></a></dt>
<dd><p>Handles incoming messages and returns a response.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Agents are stateful and the messages passed to this method should
be the new messages since the last call to this method. The agent
should maintain its state between calls to this method. For example,
if the agent needs to remember the previous messages to respond to
the current message, it should store the previous messages in the
agent state.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.UserProxyAgent.on_messages_stream">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">on_messages_stream</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">messages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">AsyncGenerator</span><span class="p"><span class="pre">[</span></span><span class="pre">ToolCallRequestEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallExecutionEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MemoryQueryEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">UserInputRequestedEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ModelClientStreamingChunkEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ThoughtEvent</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">TextMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MultiModalMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">StopMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ToolCallSummaryMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">HandoffMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">VercelMessage</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="chatflow.base.html#agentopera.chatflow.base.Response" title="agentopera.chatflow.base.chat_agent.Response"><span class="pre">Response</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/user_proxy_agent.html#UserProxyAgent.on_messages_stream"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.UserProxyAgent.on_messages_stream" title="Link to this definition"></a></dt>
<dd><p>Handle incoming messages by requesting user input.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="agentopera.chatflow.agents.UserProxyAgent.on_reset">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">on_reset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cancellation_token</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../engine/engine.types.html#agentopera.engine.types.agent.CancellationToken" title="agentopera.engine.types.agent.cancellation_token.CancellationToken"><span class="pre">CancellationToken</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/agentopera/chatflow/agents/user_proxy_agent.html#UserProxyAgent.on_reset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#agentopera.chatflow.agents.UserProxyAgent.on_reset" title="Link to this definition"></a></dt>
<dd><p>Reset agent state.</p>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="chatflow.html" class="btn btn-neutral float-left" title="chatflow" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="chatflow.base.html" class="btn btn-neutral float-right" title="chatflow.base" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, tensoropera.ai.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>